<html>  
  <head>  
  <title>视频</title>  
  <meta charset="utf-8">  
  <link href="http://cdn.bootcss.com/video.js/5.9.2/video-js.min.css" rel="stylesheet">
  <script src="http://cdn.bootcss.com/video.js/5.9.2/video.js"></script>
  <!-- If you'd like to support IE8 -->  
  <script src="http://cdn.bootcss.com/video.js/5.9.2/ie8/videojs-ie8.js"></script>
  <script src="http://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script src="http://cdn.bootcss.com/socket.io/2.0.3/socket.io.slim.js"></script>
  <script>
        videojs.options.flash.swf = "http://cdn.bootcss.com/video.js/5.9.2/video-js.swf";
       //videojs.options.flash.swf = "video-js.swf";
</script>
</head>  
<body>  
  <h1>视频</h1>  
  <video id="my-video" class="video-js"
                               width="480" height="640"
                                   data-setup='{"techorder" : ["flash"] }'>
    <source src="" type="rtmp/mp4">  
 </video>  
 <script> 
$(function() {
    function getUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg); 
        if (r != null) return unescape(r[2]); return null; 
    }

    var tag = getUrlParam('tag');
    var cam = getUrlParam('cam');
    if(tag == null) return;
    if(cam == null) cam = 0;
    var socket = io();


    socket.on('connect', function () {
        socket.emit("usr",{tag:tag,cam:cam});
        console.log("connection");

    });

    socket.on('usr', function (data) {
        console.log("recv => "+ JSON.stringify(data));
        if(data.status == 'online'){
            var myPlayer = videojs("my-video",{},function(){
                this.src(data.url);
                this.play();
            });
        }
        else
        {
            $("h1").text('设备不在线');
            socket.disconnect();
        
        }
    });


    socket.on('disconnect', function () {
        console.log('you have been disconnected');
    });

    socket.on('reconnect', function () {
        console.log('you have been reconnected');
    });

    socket.on('reconnect_error', function () {
        console.log('attempt to reconnect has failed');
    });

});

</script>
</body>  
</html>  
